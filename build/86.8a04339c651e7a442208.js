"use strict";(self.webpackChunkproduction_project=self.webpackChunkproduction_project||[]).push([[86],{4092:function(e,t,a){var s,r=a(6540);function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)({}).hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},i.apply(null,arguments)}t.A=e=>r.createElement("svg",i({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},e),s||(s=r.createElement("path",{fillRule:"evenodd",d:"m3.99 16.854-1.314 3.504a.75.75 0 0 0 .966.965l3.503-1.314a3 3 0 0 0 1.068-.687L18.36 9.175s-.354-1.061-1.414-2.122-2.122-1.414-2.122-1.414L4.677 15.786a3 3 0 0 0-.687 1.068m12.249-12.63 1.383-1.383c.248-.248.579-.406.925-.348.487.08 1.232.322 1.934 1.025.703.703.945 1.447 1.025 1.934.058.346-.1.677-.348.925L19.774 7.76s-.353-1.06-1.414-2.12c-1.06-1.062-2.121-1.415-2.121-1.415z",clipRule:"evenodd"})))},4171:function(e,t,a){a.r(t),a.d(t,{default:function(){return ee}});var s=a(673),r=a(6314),i=a(6540),n=a(4848);const c=(0,i.lazy)((()=>a.e(885).then(a.bind(a,3885)))),l=e=>(0,n.jsx)(i.Suspense,{fallback:(0,n.jsx)(r.E,{width:"100%",height:140}),children:(0,n.jsx)(c,{...e})}),o=(0,i.lazy)((()=>a.e(675).then(a.bind(a,1675)))),d=e=>(0,n.jsx)(i.Suspense,{fallback:(0,n.jsx)(r.E,{width:"100%",height:120}),children:(0,n.jsx)(o,{...e})});var m=a(6142),x=a(423),u=a(35),g=a(5701);const h=a(7867).q.injectEndpoints({endpoints:e=>({getArticleRecommendationsList:e.query({query:e=>({url:"/articles",params:{_limit:e,_expand:"user"}})})})}).useGetArticleRecommendationsListQuery;const j=(0,i.memo)((e=>{const{className:t}=e,{t:a}=(0,m.B)(),{isLoading:r,data:i,error:c}=h(4);return r||c||!i?null:(0,n.jsxs)(u.T,{max:!0,gap:"8",className:(0,x.x)("",{},[t]),children:[(0,n.jsx)(g.EY,{size:g.$C.L,title:a("Рекомендуем")}),(0,n.jsx)(s.R2,{target:"_blank",view:s.Uv.GRID,articles:i,isLoading:r,error:Boolean(c),className:"EgvxZT62"})]})}));var p=a(8623),L=a(657),f=a(7767),w=a(8238),v=a(38);const C=(0,v.zD)("articleDetails/fetchCommentsByArticleId",(async(e,t)=>{const{extra:a,rejectWithValue:s}=t;try{if(!e)throw new Error;const{data:t}=await a.api.get("/comments",{params:{articleId:e,_expand:"user"}});if(!t)throw new Error;return t}catch(e){return console.log(e),s("error")}})),y=(0,v.pU)({selectId:e=>e.id}),E=y.getSelectors((e=>e.articleDetailsPage?.comments||y.getInitialState())),I=(0,v.Z0)({name:"articleDetailsComments",initialState:y.getInitialState({isLoading:!0,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(C.pending,(e=>{e.isLoading=!0})).addCase(C.fulfilled,((e,t)=>{e.isLoading=!1,y.setAll(e,t.payload)})).addCase(C.rejected,((e,t)=>{e.isLoading=!1,e.error=t.payload}))}}),{reducer:N}=I,b=(0,v.zD)("articlesDetailsPage/fetchArticleRecommendations",(async(e,t)=>{const{extra:a,rejectWithValue:s}=t;try{const{data:e}=await a.api.get("/articles",{params:{_limit:4,_expand:"user"}});if(!e)throw new Error;return e}catch(e){return console.log(e),s("error")}})),z=(0,v.pU)({selectId:e=>e.id}),D=(z.getSelectors((e=>e.articleDetailsPage?.recommendations||z.getInitialState())),(0,v.Z0)({name:"articleDetailsRecommendations",initialState:z.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(b.pending,(e=>{e.isLoading=!0})).addCase(b.fulfilled,((e,t)=>{e.isLoading=!1,z.setAll(e,t.payload)})).addCase(b.rejected,((e,t)=>{e.isLoading=!1,e.error=t.payload}))}})),{reducer:S}=D,k=(0,w.HY)({recommendations:S,comments:N});var R=a(7625),T=a(2670),A={CommentCard:"xIHByGcu",text:"Ks7Kyp_K",isLoading:"DgfoVz0X"},_=a(569);const Y=(0,i.memo)((e=>{const{className:t,comment:a,isLoading:s}=e;return a?.user?s?(0,n.jsxs)(u.T,{max:!0,className:(0,x.x)(A.CommentCard,{},[A.isLoading,t]),children:[(0,n.jsxs)(u.z,{gap:"8",children:[(0,n.jsx)(r.E,{width:30,height:30,border:"50%"}),(0,n.jsx)(r.E,{height:16,width:100,className:A.username})]}),(0,n.jsx)(r.E,{className:A.text,width:"100%",height:50})]}):(0,n.jsxs)(u.T,{max:!0,className:(0,x.x)(A.CommentCard,{},[t]),children:[(0,n.jsx)(R.E,{to:(0,_.nL)(a?.user.id),children:(0,n.jsxs)(u.z,{gap:"8",children:[a?.user.avatar&&(0,n.jsx)(T.e,{size:30,src:a.user.avatar}),(0,n.jsx)(g.EY,{title:a?.user.username})]})}),(0,n.jsx)(g.EY,{className:A.text,text:a?.text})]}):null})),B=(0,i.memo)((e=>{const{className:t,comments:a,isLoading:s}=e,{t:r}=(0,m.B)();let i;return i=s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Y,{isLoading:s}),(0,n.jsx)(Y,{isLoading:s})]}):(0,n.jsx)(g.EY,{text:r("Комментарии отсутствуют")}),(0,n.jsx)(u.T,{max:!0,gap:"16",className:t,children:a?.length?a.map((e=>(0,n.jsx)(Y,{isLoading:s,comment:e},e.id))):i})})),O=(0,i.lazy)((()=>a.e(106).then(a.bind(a,7106))));var P=a(2828),U=a(9991),$=a(1338);const W=e=>e.articleDetailsPage?.comments?.isLoading??!0,F=e=>e.articleDetailsPage?.comments.error;var H=a(5283);const V=(0,v.zD)("articleDetails/addCommentForArticle",(async(e,t)=>{const{extra:a,dispatch:r,rejectWithValue:i,getState:n}=t,c=(0,H.ed)(n()),l=(0,s.xT)(n());if(!c||!e||!l)return i("no data");const o={articleId:l.id,userId:c.id,text:e};try{const{data:e}=await a.api.post("/comments",o);if(!e)throw new Error;return r(C(l.id)),e}catch(e){return console.log(e),i("error")}})),Z=(0,i.memo)((e=>{const{className:t,articleId:a}=e,{t:s}=(0,m.B)(),r=(0,P.j)(),c=(0,$.d4)(E.selectAll),l=(0,$.d4)(W),o=(0,$.d4)(F);(0,U.m)((()=>{r(C(a))}));const d=(0,i.useCallback)((e=>{r(V(e))}),[r]);return(0,n.jsxs)(u.T,{max:!0,gap:"16",className:t,children:[(0,n.jsx)(g.EY,{size:g.$C.L,title:s(`Комментарии(${c.length})`)}),o?(0,n.jsx)(g.EY,{title:s("Произошла ошибка при загрузке комментариев")}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O,{onSendComment:d}),(0,n.jsx)(B,{isLoading:l,comments:c})]})]})}));var q=a(4092),G=a(42),K=a(3377);const X=(0,a(1081).Mz)(s.xT,H.ed,((e,t)=>!(!e||!t)&&e.user.id===t.id));const M=(0,i.memo)((e=>{const{className:t,articleId:a}=e,{t:s}=(0,m.B)(),r=(0,f.Zp)(),c=(0,$.d4)(X),l=(0,i.useCallback)((()=>{r((0,_.t$)())}),[r]),o=(0,i.useCallback)((()=>{r((0,_._3)(a))}),[r,a]);return(0,n.jsxs)(u.z,{max:!0,justify:"between",className:t,children:[(0,n.jsx)(G.$n,{theme:G.Ox.OUTLINE,onClick:l,children:s("Все статьи")}),c&&(0,n.jsx)(G.$n,{onClick:o,theme:G.Ox.OUTLINE,children:(0,n.jsxs)(u.z,{gap:"8",children:[(0,n.jsx)(K.I,{Svg:q.A,className:(0,x.x)("_W27YO4T",{},["XRcLxUrH"])}),s("Редактировать")]})})]})})),Q={articleDetailsPage:k},J=()=>{const{id:e}=(0,f.g)(),[t,a]=(0,i.useState)(!1);return e?(0,n.jsx)(p.H,{reducers:Q,children:(0,n.jsx)(L.YW,{children:(0,n.jsxs)(u.T,{gap:"32",children:[(0,n.jsx)(M,{articleId:e}),!t&&(0,n.jsx)(l,{articleId:e}),(0,n.jsx)(s.R0,{setArticleNotFound:a,articleId:e}),!t&&(0,n.jsx)(d,{articleId:e}),(0,n.jsx)(j,{}),!t&&(0,n.jsx)(Z,{articleId:e})]})})}):null};var ee=(0,i.memo)(J)}}]);